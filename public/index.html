<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>URL Shortener</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>ðŸ”— URL Shortener</h1>
      <form class="shortener">
        <label for="long-url">Long URL</label>
        <input
          type="text"
          id="long-url"
          name="long-url"
          placeholder="Enter your long URL here..."
        />

        <label for="custom-url">Custom short URL (optional)</label>
        <input
          type="text"
          id="short-url"
          name="short-url"
          placeholder="Enter your custom short name..."
        />

        <button type="submit">Shorten</button>
      </form>

      <div class="output-box">
        <p>Your shortened URLs will appear here ðŸ‘‡</p>
      </div>
    </div>

    <script>
      // ---- Function to fetch and show data ----
      const fetchShortendURL = async () => {
        try {
          const response = await fetch("/link");
          const data = await response.json();
          console.log("Fetched data:", data); // Debugging ke liye

          const outputBox = document.querySelector(".output-box");
          outputBox.innerHTML = "<h3>ðŸ“Œ All Shortened Links:</h3>";

          // UL create karo
          const ul = document.createElement("ul");

          // Loop over JSON object
          for (const [shortCode, url] of Object.entries(data)) {
            const li = document.createElement("li");
            li.innerHTML = `
        <a href="http://localhost:3002/${shortCode}" target="_blank">
          http://localhost:3002/${shortCode}
        </a> â†’ <a href="#"><span>${url}</span> </a>
      `;
            ul.appendChild(li);
          }

          outputBox.appendChild(ul);
        } catch (err) {
          console.log("Error fetching links:", err);
        }
      };

      // ---- Form Submit Handler ----
      document
        .querySelector(".shortener")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formdata = new FormData(e.target);
          const url = formdata.get("long-url");
          const shortCode = formdata.get("short-url");

          try {
            const response = await fetch("/shortend", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ url, shortCode }),
            });

            if (response.ok) {
              alert("Form submitted successfully âœ…");
              e.target.reset();
              fetchShortendURL(); // ðŸ‘ˆ Refresh list after new entry
            } else {
              const errorMessage = await response.text();
              alert(errorMessage);
            }
          } catch (err) {
            console.log("Error submitting form:", err);
          }
        });

      // ---- Load links on page load ----
      fetchShortendURL();
    </script>
  </body>
</html>
